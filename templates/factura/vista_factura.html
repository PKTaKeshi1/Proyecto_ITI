{% extends 'base.html' %}

{% block content %}
<style>
  .marco-factura {
    border: 3px solid #333;
    border-radius: 10px;
    padding: 25px;
    box-shadow: 0 0 10px #aaa;
    background: #fff;
    max-width: 900px;
    margin: 20px auto;            /* separación superior/inferior para que no corte elementos */
    padding-bottom: 30px;         /* espacio extra para totales */
    box-sizing: border-box;
  }

  .cabecera, .cliente-info, .detalle-tabla {
    width: 100%;
    margin-bottom: 15px;
  }

  .cabecera td {
    vertical-align: top;
  }

  .titulo {
    font-weight: bold;
    background-color: #eee;
    padding: 5px;
    border: 1px solid #000;
  }

  .factura-box {
    border: 1px solid #000;
    padding: 10px;
    text-align: right;
  }

  .detalle-tabla, .detalle-tabla th, .detalle-tabla td {
    border: 1px solid #000;
    border-collapse: collapse;
  }

  .detalle-tabla th, .detalle-tabla td {
    padding: 5px;
  }

  .derecha { text-align: right; }
  .centro { text-align: center; }

  .resaltado {
    font-weight: bold;
    border: 1px solid #000;
    padding: 4px;
  }

  /* ESTILOS PARA TOTALES: fijo dentro del marco y alineado a la derecha */
  .totales {
    width: 340px;
    margin: 12px 0 0 auto;   /* empuja a la derecha pero permanece dentro del marco */
    border-collapse: collapse;
  }
  .totales td {
    padding: 6px 8px;
    vertical-align: top;
  }
  .totales tr td:first-child { color: #000; }
  .totales tr td:last-child { text-align: right; font-weight: 600; }

  /* Evitar que tablas se rompan visualmente */
  table { table-layout: auto; }
</style>

<div class="container mt-4">

  <!-- ÚNICO BOTÓN SUPERIOR -->
  <div class="mb-3">
    <a href="{{ url_for('factura.listar') }}" class="btn btn-secondary">
      ← Regresar al listado
    </a>
  </div>

  <div class="marco-factura">

    <!-- CABECERA -->
    <table class="cabecera">
      <tr>
        <td>
          <div class="titulo">FACTURA</div>
          <p><strong>HLC</strong><br>
          AMPLIACION ALTO CERRO VERDE G-9<br>
          UCHUMAYO - AREQUIPA - AREQUIPA</p>
        </td>

        <td class="factura-box">
          <p><strong>FACTURA EMITIDA</strong><br>
          RUC: 20236018113<br>
          {{ factura[1] }} - {{ factura[2] }}</p>
        </td>
      </tr>
    </table>

    <!-- DATOS DEL CLIENTE -->
    <table class="cliente-info">
      <tr>
        <td>FECHA DE EMISIÓN: {{ factura[3] }}</td>
        <td>FORMA DE PAGO: CONTADO</td>
      </tr>
      <tr>
        <td>CLIENTE: {{ factura[10] }}</td>
      </tr>
      <tr>
        <td>RUC: {{ factura[11] }}</td>
      </tr>
      <tr>
        <td>TIPO DE MONEDA: {{ factura[12] }}</td>
        <td>OBSERVACIÓN: NINGUNA</td>
      </tr>
    </table>

    <!-- DETALLE -->
    <table class="detalle-tabla">
      <thead>
        <tr class="centro">
          <th>Producto</th>
          <th>Cantidad</th>
          <th>Precio Unitario</th>
          <th>Subtotal</th>
        </tr>
      </thead>
      <tbody>
        {% for item in detalle %}
        <tr>
          <td>{{ item[0] }}</td>
          <td class="centro">{{ item[1] }}</td>
          <td class="derecha">{{ "%.2f"|format(item[2]) }}</td>
          <td class="derecha">{{ "%.2f"|format(item[3]) }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- MONTO EN LETRAS -->
    <p class="resaltado mt-2">SON: {{ monto_letras }}</p>

    <!-- TOTALES -->
    <table class="totales">
      <tr><td>VALOR DE VENTA:</td><td class="derecha">S/ {{ "%.2f"|format(factura[4]) }}</td></tr>
      <tr><td>IGV:</td><td class="derecha">S/ {{ "%.2f"|format(factura[5]) }}</td></tr>
      <tr><td>OTROS CARGOS:</td><td class="derecha">S/ 0.00</td></tr>
      <tr>
        <td><strong>IMPORTE TOTAL:</strong></td>
        <td class="derecha"><strong>S/ {{ "%.2f"|format(factura[6]) }}</strong></td>
      </tr>
    </table>

  </div>

</div>

{% endblock %}
